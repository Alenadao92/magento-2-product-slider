<?php
/**
 * Mageplaza
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the mageplaza.com license that is
 * available through the world-wide-web at this URL:
 * https://www.mageplaza.com/LICENSE.txt
 *
 * DISCLAIMER
 *
 * Do not edit or add to this file if you wish to upgrade this extension to newer
 * version in the future.
 *
 * @category    Mageplaza
 * @package     Mageplaza_Productslider
 * @copyright   Copyright (c) 2017-2018 Mageplaza (https://www.mageplaza.com/)
 * @license     https://www.mageplaza.com/LICENSE.txt
 */
?>

<div class="entry-edit">
    <?php echo $block->getForm()->getHtml() ?>
</div>

<div id="mp-slider-grid-product"></div>

<script type="text/javascript">
    require([
        'jquery'
    ], function ($) {
        var productGrid = $('#mp-slider-grid-product'),
            categoryGrid = $('.field-categories_ids'),
            productType = $('#slider_product_type');
        productGrid.hide();
        categoryGrid.hide();

        if(productType.val() == 'categoryId'){
            categoryGrid.show();
        }

        if(productType.val() == 'custom'){
            productGrid.show();
            getAjaxProductGrid();
        }

        productType.change(function () {
            var optionSelected = $(this).find("option:selected");
            var valueSelected  = optionSelected.val();

            if(valueSelected == 'categoryId'){
                categoryGrid.show();
                productGrid.hide();
            } else if(valueSelected == 'custom') {
                productGrid.show();
                categoryGrid.hide();
                getAjaxProductGrid();
            } else {
                categoryGrid.hide();
                productGrid.hide();
            }
        });

        function getAjaxProductGrid() {
            $.ajax({
                url:  '<?php echo $block->getUrl('mageplaza_productslider/slider/products',['form_key'=>$block->getFormKey(),'_current' => true]); ?>',
                dataType: 'json',
                cache: false
            }).done(function (data) {
                productGrid.html(data.output);
                productGrid.trigger('contentUpdated');
            });
        }
    });
</script>

